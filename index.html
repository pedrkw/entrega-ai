<!DOCTYPE html>
<html>
<head>
    <title>Google Maps Geolocation and Directions</title>
    <style>
        /* Estilo para o mapa */
        #map {
            height: 800px;
            width: 100%;
        }
    </style>
</head>
<body>
    <h1>Localize-se e Calcule Distância</h1>
    <div id="map"></div>
    <button onclick="getUserLocation()">Encontrar Minha Localização</button>
    <p>Origem: <span id="origin">Clique no mapa para definir</span></p>
    <p>Destino: <span id="destination">Clique no mapa para definir</span></p>
    <p>Distância por estrada: <span id="distance">-</span> km</p>
    <p>Tempo estimado: <span id="duration">-</span></p>

    <script>
        var map;
        var directionsService;
        var directionsRenderer;
        var originLatLng = null;
        var destinationLatLng = null;

        function initMap() {
            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer();

            var coordenadas = { lat: -5.302041925508938, lng: -38.93314844402641 };

            map = new google.maps.Map(document.getElementById('map'), {
                center: coordenadas,
                zoom: 15,  // Adjust the initial zoom level as needed
                mapTypeId: 'roadmap'  // Set the map type to "roadmap" by default
            });

            directionsRenderer.setMap(map);

            map.addListener('click', function(event) {
                if (!originLatLng) {
                    originLatLng = event.latLng;
                    document.getElementById('origin').textContent = 'Origem: ' + event.latLng.toString();
                } else if (!destinationLatLng) {
                    destinationLatLng = event.latLng;
                    document.getElementById('destination').textContent = 'Destino: ' + event.latLng.toString();
                    calculateRoute();
                }
            });
        }

        function getUserLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    var userLat = position.coords.latitude;
                    var userLng = position.coords.longitude;
                    var userLocation = new google.maps.LatLng(userLat, userLng);

                    map.setCenter(userLocation);

                    var userMarker = new google.maps.Marker({
                        position: userLocation,
                        map: map,
                        title: 'Sua Localização'
                    });

                    document.getElementById('origin').textContent = 'Origem: Sua Localização';
                    originLatLng = userLocation;

                    if (destinationLatLng) {
                        calculateRoute();
                    }
                }, function(error) {
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            alert("Permissão para geolocalização negada pelo usuário.");
                            break;
                        case error.POSITION_UNAVAILABLE:
                            alert("Informações de localização indisponíveis.");
                            break;
                        case error.TIMEOUT:
                            alert("Tempo limite para obter a localização esgotado.");
                            break;
                        case error.UNKNOWN_ERROR:
                            alert("Erro desconhecido ao obter a localização.");
                            break;
                    }
                });
            } else {
                alert("Seu navegador não suporta geolocalização.");
            }
        }

        function calculateRoute() {
            if (originLatLng && destinationLatLng) {
                var request = {
                    origin: originLatLng,
                    destination: destinationLatLng,
                    travelMode: 'DRIVING'
                };

                directionsService.route(request, function(result, status) {
                    if (status == 'OK') {
                        var route = result.routes[0];
                        var distance = route.legs[0].distance.text;
                        var duration = route.legs[0].duration.text;

                        document.getElementById('distance').textContent = 'Distância por estrada: ' + distance;
                        document.getElementById('duration').textContent = 'Tempo estimado: ' + duration;

                        directionsRenderer.setDirections(result);
                    } else {
                        alert('Não foi possível calcular a rota: ' + status);
                    }
                });
            }
        }
    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB41DRUbKWJHPxaFjMAwdrzWzbVKartNGg&callback=initMap" async defer></script>
</body>
</html>
